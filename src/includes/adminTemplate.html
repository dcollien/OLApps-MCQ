<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Quiz Admin</title>
		<link rel="stylesheet" href="/common/bootstrap/css/bootstrap.min.css" type="text/css" media="screen" charset="utf-8">
		<script src="/common/jquery.min.js"></script>
		{{&app_init_js}}
		<script src="{{ jquery_spin }}"></script>
		<script src="{{ jquery_json }}"></script>
		
		<script>
			$(document).ready( function( ) {

				$.spin.imageBasePath = '';
				$.spin.spinBtnImage  = '{{ spin_button }}';
				$.spin.spinUpImage   = '{{ spin_up }}';
				$.spin.spinDownImage = '{{ spin_down }}';
				$('.spinner').spin( { max: 10, min: 2 } );
				
				var questions = {{&questionsJSON}};
				//var questions = JSON.parse( questionsJSON );
				
				var $questionBox = $('<form class="form-horizontal">');

				$(questions).each( function( index, element ) {
					var $ctrlGroup = $('<div class="control-group">');

					var $label = $('<label class="control-label">').text( 'Question ' + (index+1) );
					
					var $text = $('<input type="text" name="questions[' + index + '][text]" class="input-large">').val( element.text );
					
					var $correct = $('<input type="text" name="questions[' + index + '][correct]" class="input-mini">').val( element.correct );
					
					var $answers = $('<div class="controls">');

					$(element.answers).each( function( ansIndex, ansElement ) {
						var $answerText = $('<input type="text" name="questions[' + index + '][answers][' + ansIndex + '][text]" class="input-large">').val( ansElement.text );
						var $answerValue = $('<input type="text" name="questions[' + index + '][answers][' + ansIndex + '][value]" class="input-mini">').val( ansElement.value );

						$answers.append( $answerText );
						$answers.append( $answerValue );
						$answers.append( '<br>' );
					} );

					$ctrlGroup.append( $label );
					$ctrlGroup.append( '<br>' );
					$ctrlGroup.append( $text );
					$ctrlGroup.append( '<br>' );
					$ctrlGroup.append( $('<label class="control-label">').text( 'Correct Answer (identifier):' ) );
					$ctrlGroup.append( $correct );
					$ctrlGroup.append( $('<label class="control-label">').text( 'Answers:' ) );
					$ctrlGroup.append( '<br>' );
					$ctrlGroup.append( $answers );

					$questionBox.append( $ctrlGroup );
				} );
				
				$('#questions').html( $questionBox );

				/*
				JSON format:
				questions = [
				  {
				    "text": "Question Text",
				    "correct": "C",
				    "answers": [
				      {
				        "text": "Answer Text",
				        "value": "A"
				      },
				      {
				        "text": "Answer Text",
				        "value": "B"
				      },
				      {
				        "text": "Answer Text",
				        "value": "C"
				      }
				    ]
				  },
				
				  ...
				  ]
				*/
				
			});
		</script>
		
		<style>
			.box-full {
				box-sizing: border-box;
				-webkit-box-sizing:border-box;
				-moz-box-sizing: border-box;
				-ms-box-sizing: border-box;
				width: 100%;
			}

			.question {
				border-bottom: 1px solid #ccc;
			}
		</style>
	</head>
	<body>
	{{error}}
	 <div class="container">
		<form method="post" class="form-horizontal">
			
			<fieldset>
				{{&csrf_token}}
				
				<legend>Quiz Set-up</legend>
				<div class="control-group">
					<label class="control-label" for="title">Quiz title</label>
					<div class="controls">
						<input type="text" class="input-large" name="title" id="title" value="{{title}}">
					</div>
				</div>
				
				<div class="control-group">
					<label class="control-label" for="doneText">Submission button text</label>
					<div class="controls">
						<input type="text" class="input-large" name="doneText" id="doneText" value="{{doneText}}">
					</div>
				</div>
				
				<div class="control-group">
					<label class="control-label" for="doneText">Show answers on completion</label>
					<div class="controls">
						<input type="checkbox" name="showAnswers" id="showAnswers" {{#showAnswers}}checked="checked"{{/showAnswers}}>
					</div>
				</div>

				<div class="control-group">
					<label class="control-label" for="doneText">Allow Multiple Submission</label>
					<div class="controls">
						<input type="checkbox" name="allowMultipleSubmission" id="allowMultipleSubmission" {{#allowMultipleSubmission}}checked="checked"{{/allowMultipleSubmission}}>
					</div>
				</div>
				
				<legend>Questions</legend>
				<div id="questions">
					<div id="question1" class="question">
						
						<!-- TODO: Make GUI (re-orderable, dynamic questions)
						<h3>Question 1</h3>
						<textarea name="question1_text" class="box-full" style="height: 100px"></textarea>
						<br/>
						<h4>Answers:</h4>
						<div class="well" style="float:right; margin-right: 15px">
							<center>
								Number of Answers:<br/>
								<input type="text" class="spinner input-mini" name="question1_numAnswers" value="4">
							</center>
						</div>
						<div style="display: inline-block; padding-left: 10px;">
							<input type="radio" name="question1_correct" value="A" checked="checked"></input> <input type="text" name="question1_answer1" class="input-xlarge" style="margin-top: 3px"><br/>
							<input type="radio" name="question1_correct" value="B"></input> <input type="text" name="question1_answer2" class="input-xlarge" style="margin-top: 3px"><br/>
							<input type="radio" name="question1_correct" value="C"></input> <input type="text" name="question1_answer3" class="input-xlarge" style="margin-top: 3px"><br/>
							<input type="radio" name="question1_correct" value="D"></input> <input type="text" name="question1_answer4" class="input-xlarge" style="margin-top: 3px"><br/>
						</div>
						<br/><br/>
					</div>
					 -->
					<div id="questions"></div>
					<textarea name="questionsJSON" class="box-full hide" style="height: 280px" id="questionsJSON">{{questionsJSON}}</textarea>
				</div>
				
				<div class="form-actions">
					<button type="submit" class="btn btn-primary">Save Quiz</button>
				</div>
			</fieldset>
		</form>
	 </div>
	</body>
</html>